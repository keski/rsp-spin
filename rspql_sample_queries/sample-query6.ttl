@prefix :      <http://debs2015.org/streams/> .
@prefix ex:    <http://example.org/> .
@prefix xsd:   <http://www.w3.org/2001/XMLSchema#> .
@prefix debs:  <http://debs2015.org/onto#> .
@prefix sp:    <http://spinrdf.org/sp#> .
@prefix rsp:   <http://w3id.org/rsp/spin#> .

[ a                    sp:Select ;
  sp:resultVariables   ( [ sp:varName  "luckyRide"^^xsd:string ] ) ;
  sp:where             ( [ a                   rsp:NamedWindow ;
                           sp:elements         ( [ sp:object     [ sp:varName  "taxi"^^xsd:string ] ;
                                                   sp:predicate  debs:byTaxi ;
                                                   sp:subject    [ sp:varName  "luckyRide"^^xsd:string ]
                                                 ] [ a              sp:Filter ;
                                                     sp:expression  [ a            sp:notExists ;
                                                                      sp:elements  ( [ sp:object     [ sp:varName  "trafficLight"^^xsd:string ] ;
                                                                                       sp:predicate  ex:stoppedAt ;
                                                                                       sp:subject    [ sp:varName  "luckyRide"^^xsd:string ]
                                                                                     ] )
                                                                    ]
                                                   ] ) ;
                           rsp:windowNameNode  :win
                         ] ) ;
  rsp:fromNamedWindow  [ a                rsp:LogicalWindow ;
                         rsp:logicalStep  "PT1H"^^xsd:duration ;
                         rsp:range        "PT1H"^^xsd:duration ;
                         rsp:streamIri    :rides ;
                         rsp:windowIri    :win
                       ]
] .