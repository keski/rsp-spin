@prefix :      <http://debs2015.org/streams/> .
@prefix xsd:   <http://www.w3.org/2001/XMLSchema#> .
@prefix debs:  <http://debs2015.org/onto#> .
@prefix sp:    <http://spinrdf.org/sp#> .
@prefix rsp:   <http://w3id.org/rsp/spin#> .

[ a                    sp:Select ;
  sp:resultVariables   ( [ sp:varName  "distance"^^xsd:string ] [ sp:expression  [ a        sp:sub ;
                                                                                   sp:arg1  [ a        sp:sub ;
                                                                                              sp:arg1  [ a        sp:sub ;
                                                                                                         sp:arg1  [ sp:varName  "amount"^^xsd:string ] ;
                                                                                                         sp:arg2  [ sp:varName  "tax"^^xsd:string ]
                                                                                                       ] ;
                                                                                              sp:arg2  [ sp:varName  "tips"^^xsd:string ]
                                                                                            ] ;
                                                                                   sp:arg2  [ sp:varName  "tolls"^^xsd:string ]
                                                                                 ] ;
                                                                  sp:varName     "profit"^^xsd:string
                                                                ] ) ;
  sp:where             ( [ a                   rsp:NamedWindow ;
                           sp:elements         ( [ sp:object     [ sp:varName  "distance"^^xsd:string ] ;
                                                   sp:predicate  debs:trip_distance ;
                                                   sp:subject    [ sp:varName  "ride"^^xsd:string ]
                                                 ] [ sp:object     [ sp:varName  "amount"^^xsd:string ] ;
                                                     sp:predicate  debs:total_amount ;
                                                     sp:subject    [ sp:varName  "ride"^^xsd:string ]
                                                   ] [ sp:object     [ sp:varName  "tax"^^xsd:string ] ;
                                                       sp:predicate  debs:mta_tax ;
                                                       sp:subject    [ sp:varName  "ride"^^xsd:string ]
                                                     ] [ sp:object     [ sp:varName  "tips"^^xsd:string ] ;
                                                         sp:predicate  debs:tip_amount ;
                                                         sp:subject    [ sp:varName  "ride"^^xsd:string ]
                                                       ] [ sp:object     [ sp:varName  "tolls"^^xsd:string ] ;
                                                           sp:predicate  debs:tolls_amount ;
                                                           sp:subject    [ sp:varName  "ride"^^xsd:string ]
                                                         ] ) ;
                           rsp:windowNameNode  :wind
                         ] ) ;
  rsp:fromNamedWindow  [ a                rsp:LogicalWindow ;
                         rsp:logicalStep  "PT1H"^^xsd:duration ;
                         rsp:range        "PT1H"^^xsd:duration ;
                         rsp:streamIri    :rides ;
                         rsp:windowIri    :wind
                       ]
] .