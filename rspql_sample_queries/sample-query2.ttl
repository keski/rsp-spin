@prefix :      <http://debs2015.org/streams/> .
@prefix rdf:   <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix xsd:   <http://www.w3.org/2001/XMLSchema#> .
@prefix debs:  <http://debs2015.org/pred#> .
@prefix sp:    <http://spinrdf.org/sp#> .
@prefix rsp:   <http://w3id.org/rsp/spin#> .

[ a                    sp:Select ;
  sp:groupBy           ( [ sp:varName  "location"^^xsd:string ] ) ;
  sp:having            ( [ a        sp:ge ;
                           sp:arg1  [ sp:varName  "taxinumber"^^xsd:string ] ;
                           sp:arg2  20
                         ] ) ;
  sp:resultVariables   ( [ sp:varName  "location"^^xsd:string ] [ sp:expression  [ a              sp:Count ;
                                                                                   sp:distinct    true ;
                                                                                   sp:expression  [ sp:varName  "taxi"^^xsd:string ]
                                                                                 ] ;
                                                                  sp:varName     "taxinumber"^^xsd:string
                                                                ] ) ;
  sp:where             ( [ sp:object     :dropoffLocation ;
                           sp:predicate  <file:///Users/robke04/Documents/workspace/rsp-spin-dev/type> ;
                           sp:subject    [ sp:varName  "location"^^xsd:string ]
                         ] [ a                   rsp:NamedWindow ;
                             sp:elements         ( [ sp:object     [ sp:varName  "location"^^xsd:string ] ;
                                                     sp:predicate  debs:dropoff ;
                                                     sp:subject    [ sp:varName  "taxi"^^xsd:string ]
                                                   ] ) ;
                             rsp:windowNameNode  :w
                           ] ) ;
  rsp:fromNamedWindow  [ a                rsp:LogicalWindow ;
                         rsp:logicalStep  "PT30M"^^xsd:duration ;
                         rsp:range        "PT1H"^^xsd:duration ;
                         rsp:streamIri    :trips ;
                         rsp:windowIri    :w
                       ] ;
  rsp:registerAs       :query
] .